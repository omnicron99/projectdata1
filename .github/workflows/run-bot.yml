name: Preencher Planilhas Ads

on:
  workflow_dispatch:
  schedule:
    - cron: '0 11 * * *' # 08:00 BRT

jobs:
  run-bot:
    runs-on: ubuntu-latest

    steps:
    - name: Checar código
      uses: actions/checkout@v3

    - name: Configurar Python
      uses: actions/setup-python@v4
      with:
        python-version: '3.11'

    - name: Instalar dependências
      run: |
        python -m pip install --upgrade pip
        pip install -r requirements.txt

    - name: Adicionar credenciais
      run: |
        echo '{
          "type": "service_account",
          "project_id": "projeto-dados-campanhas",
          "private_key_id": "68c84df20da7f34762762afc0fc3abefc218007a",
          "private_key": "-----BEGIN PRIVATE KEY-----\\nMIIEvwIBADANBgkqhkiG9w0BAQEFAASCBKkwggSlAgEAAoIBAQCmG9Z7ko4Z53Gd\\noXU5jn4lxJd5gZtULg3PWgC2W5C3NMHXwg/DOsWMhuQYhdD7/hho5s/g/+IVAxNL\\ntzvk6QI++p7YwCZqmX11lHNb8Vxkv7KBtbShjT0KrTHhJyaFguChIn2uR2jai6bq\\nTQOlesLwwmxOI0FblwHYZ91z6RcCI0R3baomPGvj3R2O36j186of/7MKDNZEGYj5\\nmmhzd+7qJjxbY2cqAgnGDTsTsqpMPJr6nq057v/lWsEsOeO77uORXJ6n/6Qt3GIW\\nhMq/VOc1Z8t0KKDt4+2/XjiT9ScbUUmCiDr/acr9MohVCZ/HIdRf2JDvmi9KXBcK\\nGRXilG2lAgMBAAECggEABidp3tIjKZqFfw2IRkWdLtEFu56tnoTGRjRTam4iAmeV\\n9uRdqSH4R6iHstDiWTOku94xPWi9e4HNqTR0p5pqVuL6F5Wm1rQxDbYeP/3FKoZf\\nmqacto+A/3BDNNA6gR/EKrQYa+iBXfdmi6+mvu65YioR0SNFPJtvmhDfB3hPPej5\\nLGR7SoNxtIDbzm2t3n/LGfsb3AcLu1qXx2hHqoI7GT8MYErbv/OsKG6/gbnnMiRo\\niXPHgMNSkCpkVNbhqyfY8JNs7TW37BCMKvaQhaHoLbYo25+tEklwbHynjmWZ+h+T\\n6OTluhvU2lHJlNK5ZQdUuOieaixcYXVSzEnvyrdzgQKBgQDqg4dlGzGT5r8t+oFi\\nBFGY0q5/LByfaGYW8J5qQyvad+SDc3y7iJIXcpPMH9wgDBXomS0uAREea/1LquC9\\nwtiI38bfU+QKNMu/LLYRDMCfjp9hP5Y9oNC+VXgmumNpxLjHplWuzWQ9GlmenPdO\\nC4vrn5yxwcqL5m24Ns8ZC5rsWQKBgQC1U+IV6duVx7TjbJFG7NGOX6QXs3UW+WZb\\neL2sE2sen5Q2p+BW/Cx0onTM87B8VAPUxIU348w9DAg2vwGVGWbl00lAvNgAsOWX\\n/986TzZ2FXSjX/SU3DQ3pUBRojLOqKwdb01DVoyfX2flOe/siiot5FzW3xLZLpyG\\nTKyq87uyLQKBgQC6OzEuLWY1mayAispsWBmkTsqb2x/vxywrU3G52RXeLA+gA/ot\\nwsqhLDAKjdJ08KQFTn7+ZYJ+sis4B77pcu4Z4/s+JpSVNlAGxS7gY0wkaVJQG/rn\\nfenG/ICp4KJJwBstEP5CDoFntKEuwF/z7l9zAhGhZ8+9QYQoIf5cWUbyIQKBgQCI\\nk9Uf8lR9/b1G65iFVo0E8w7y9y3DjzjEvy4GNV4i48nMXShB/JEzjMXzNb4B93on\\nQZqiHUfR14U8TyRO/KIfi8SKKXN9GcDle0nVbqKz0LdY80aS9UWzgBnxIv2n4S46\\nwYHtrXwf8smbw8buYKcih/ZRthZJVa16Drijzw/aRQKBgQC3bUPl1aC0etkZnEhA\\n2lHKcYN0Dp3wT0iVVqjbM5UftjuIO1AxR47Tl7wIAdxRigJiyCCAVkFPitHscGDP\\n+fqaLokaUo4k9ZC0Y5oKMqOuiNuDDM4QqpJg4cyDonRUalonGfQtZa+P4PeJ5wcq\\nzeKme8c2lJjS9mFvtvDSBOQRbA==\\n-----END PRIVATE KEY-----\\n",
          "client_email": "planilha-sheets-clientes-cj@projeto-dados-campanhas.iam.gserviceaccount.com",
          "client_id": "115336424946366515252",
          "auth_uri": "https://accounts.google.com/o/oauth2/auth",
          "token_uri": "https://oauth2.googleapis.com/token",
          "auth_provider_x509_cert_url": "https://www.googleapis.com/oauth2/v1/certs",
          "client_x509_cert_url": "https://www.googleapis.com/robot/v1/metadata/x509/planilha-sheets-clientes-cj%40projeto-dados-campanhas.iam.gserviceaccount.com",
          "universe_domain": "googleapis.com"
        }' > credentials.json

    - name: Verificar conteúdo do arquivo credentials.json
      run: |
        echo ">> Começo do arquivo:"
        head -n 5 credentials.json

    - name: Testar se secret está preenchido
      run: |
        if [ -z "${{ secrets.GS_CREDENTIALS }}" ]; then
          echo "❌ O secret GS_CREDENTIALS está vazio ou inválido"
        else
          echo "✅ O secret GS_CREDENTIALS foi lido corretamente"
        fi


    - name: Rodar script
      run: python preencher_planilhas_ads.py
